### 7.13.2 PropertySource abstraction

Spring’s`Environment`abstraction provides search operations over a configurable hierarchy of property sources. To explain fully, consider the following:

```
ApplicationContext ctx = new GenericApplicationContext();
Environment env = ctx.getEnvironment();
boolean containsFoo = env.containsProperty("foo");
System.out.println("Does my environment contain the 'foo' property? " + containsFoo);
```

In the snippet above, we see a high-level way of asking Spring whether the`foo`property is defined for the current environment. To answer this question, the`Environment`object performs a search over a set of[`PropertySource`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/core/env/PropertySource.html)objects. A`PropertySource`is a simple abstraction over any source of key-value pairs, and Spring’s[`StandardEnvironment`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/core/env/StandardEnvironment.html)is configured with two PropertySource objects — one representing the set of JVM system properties \(_a la_`System.getProperties()`\) and one representing the set of system environment variables \(_a la_`System.getenv()`\).

> These default property sources are present for`StandardEnvironment`, for use in standalone applications.[`StandardServletEnvironment`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/web/context/support/StandardServletEnvironment.html)is populated with additional default property sources including servlet config and servlet context parameters.[`StandardPortletEnvironment`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/web/portlet/context/StandardPortletEnvironment.html)similarly has access to portlet config and portlet context parameters as property sources. Both can optionally enable a[`JndiPropertySource`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/jndi/JndiPropertySource.html). See the javadocs for details. |

Concretely, when using the`StandardEnvironment`, the call to`env.containsProperty("foo")`will return true if a`foo`system property or`foo`environment variable is present at runtime.

> The search performed is hierarchical. By default, system properties have precedence over environment variables, so if the`foo`property happens to be set in both places during a call to`env.getProperty("foo")`, the system property value will 'win' and be returned preferentially over the environment variable. Note that property values will not get merged but rather completely overridden by a preceding entry.For a common`StandardServletEnvironment`, the full hierarchy looks as follows, with the highest-precedence entries at the top:
* ServletConfig parameters \(if applicable, e.g. in case of a`DispatcherServlet`context\)
* ServletContext parameters \(web.xml context-param entries\)
* JNDI environment variables \("java:comp/env/" entries\)
* JVM system properties \("-D" command-line arguments\)
* JVM system environment \(operating system environment variables\) |

Most importantly, the entire mechanism is configurable. Perhaps you have a custom source of properties that you’d like to integrate into this search. No problem — simply implement and instantiate your own`PropertySource`and add it to the set of`PropertySources`for the current`Environment`:

```
ConfigurableApplicationContext ctx = new GenericApplicationContext();
MutablePropertySources sources = ctx.getEnvironment().getPropertySources();
sources.addFirst(new MyPropertySource());
```

In the code above,`MyPropertySource`has been added with highest precedence in the search. If it contains a`foo`property, it will be detected and returned ahead of any`foo`property in any other`PropertySource`. The[`MutablePropertySources`](http://docs.spring.io/spring-framework/docs/4.3.11.RELEASE/javadoc-api/org/springframework/core/env/MutablePropertySources.html)API exposes a number of methods that allow for precise manipulation of the set of property sources.

